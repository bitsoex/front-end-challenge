import React from 'react';
import LastTrades from '../../src/Components/LastTrades';
import renderer from 'react-test-renderer';
import axios from 'axios';
import MockAdapter from 'axios-mock-adapter';

console.error = jest.fn();
const componentName = "LastTrades ";

test(componentName + 'Exception on required props', () => {
    renderer.create(
        <LastTrades/>
    );
    expect(console.error).toHaveBeenCalledTimes(2);
});

test(componentName + 'Render with out errors', () => {
    const component = renderer.create(
        <LastTrades book={"btc_mxn"} trades={[]}/>
    )
    let tree = component.toJSON();
    expect(tree).toMatchSnapshot();
});

test(componentName + 'set new trade', () => {
    const component = renderer.create(
        <LastTrades book={"btc_mxn"} trades={[{
            "i": 7693045,
            "a": "0.00099991",
            "r": "153697.55",
            "v": "153.68371722",
            "mo": "CyQQFbmz7GhBbsbI",
            "to": "aJZUXFxbvzAV1MIE",
            "t": 0
        }]}/>
    )
    let tree = component.toJSON();
    expect(tree).toMatchSnapshot();
});

test(componentName + 'Slice on over than 50 Trades', () => {
    const _60Trades = [{
        "i": 1,
        "a": "00001",
        "r": "100.55",
        "v": "10.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 2,
        "a": "00002",
        "r": "200.55",
        "v": "20.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 3,
        "a": "00003",
        "r": "300.55",
        "v": "30.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 4,
        "a": "00004",
        "r": "400.55",
        "v": "40.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 5,
        "a": "00005",
        "r": "500.55",
        "v": "50.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 6,
        "a": "00006",
        "r": "600.55",
        "v": "60.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 7,
        "a": "00007",
        "r": "700.55",
        "v": "70.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 8,
        "a": "00008",
        "r": "800.55",
        "v": "80.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 9,
        "a": "00009",
        "r": "900.55",
        "v": "90.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 10,
        "a": "0.00010",
        "r": "1000.55",
        "v": "100.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 11,
        "a": "0.00011",
        "r": "1100.55",
        "v": "110.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 12,
        "a": "0.00012",
        "r": "1200.55",
        "v": "120.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 13,
        "a": "0.00013",
        "r": "1300.55",
        "v": "130.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 14,
        "a": "0.00014",
        "r": "1400.55",
        "v": "140.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 15,
        "a": "0.00015",
        "r": "1500.55",
        "v": "150.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 16,
        "a": "0.00016",
        "r": "1600.55",
        "v": "160.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 17,
        "a": "0.00017",
        "r": "1700.55",
        "v": "170.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 18,
        "a": "0.00018",
        "r": "1800.55",
        "v": "180.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 19,
        "a": "0.00019",
        "r": "1900.55",
        "v": "190.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 20,
        "a": "0.00020",
        "r": "2000.55",
        "v": "200.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 21,
        "a": "0.00021",
        "r": "2100.55",
        "v": "210.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 22,
        "a": "0.00022",
        "r": "2200.55",
        "v": "220.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 23,
        "a": "0.00023",
        "r": "2300.55",
        "v": "230.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 24,
        "a": "0.00024",
        "r": "2400.55",
        "v": "240.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 25,
        "a": "0.00025",
        "r": "2500.55",
        "v": "250.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 26,
        "a": "0.00026",
        "r": "2600.55",
        "v": "260.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 27,
        "a": "0.00027",
        "r": "2700.55",
        "v": "270.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 28,
        "a": "0.00028",
        "r": "2800.55",
        "v": "280.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 29,
        "a": "0.00029",
        "r": "2900.55",
        "v": "290.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 30,
        "a": "0.00030",
        "r": "3000.55",
        "v": "300.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 31,
        "a": "0.00031",
        "r": "3100.55",
        "v": "310.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 32,
        "a": "0.00032",
        "r": "3200.55",
        "v": "320.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 33,
        "a": "0.00033",
        "r": "3300.55",
        "v": "330.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 34,
        "a": "0.00034",
        "r": "3400.55",
        "v": "340.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 35,
        "a": "0.00035",
        "r": "3500.55",
        "v": "350.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 36,
        "a": "0.00036",
        "r": "3600.55",
        "v": "360.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 37,
        "a": "0.00037",
        "r": "3700.55",
        "v": "370.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 38,
        "a": "0.00038",
        "r": "3800.55",
        "v": "380.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 39,
        "a": "0.00039",
        "r": "3900.55",
        "v": "390.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 40,
        "a": "0.00040",
        "r": "4000.55",
        "v": "400.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 41,
        "a": "0.00041",
        "r": "4100.55",
        "v": "410.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 42,
        "a": "0.00042",
        "r": "4200.55",
        "v": "420.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 43,
        "a": "0.00043",
        "r": "4300.55",
        "v": "430.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 44,
        "a": "0.00044",
        "r": "4400.55",
        "v": "440.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 45,
        "a": "0.00045",
        "r": "4500.55",
        "v": "450.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 46,
        "a": "0.00046",
        "r": "4600.55",
        "v": "460.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 47,
        "a": "0.00047",
        "r": "4700.55",
        "v": "470.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 48,
        "a": "0.00048",
        "r": "4800.55",
        "v": "480.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 49,
        "a": "0.00049",
        "r": "4900.55",
        "v": "490.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 50,
        "a": "0.00050",
        "r": "5000.55",
        "v": "500.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 51,
        "a": "0.00051",
        "r": "5100.55",
        "v": "510.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 52,
        "a": "0.00052",
        "r": "5200.55",
        "v": "520.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 53,
        "a": "0.00053",
        "r": "5300.55",
        "v": "530.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 54,
        "a": "0.00054",
        "r": "5400.55",
        "v": "540.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 55,
        "a": "0.00055",
        "r": "5500.55",
        "v": "550.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 56,
        "a": "0.00056",
        "r": "5600.55",
        "v": "560.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 57,
        "a": "0.00057",
        "r": "5700.55",
        "v": "570.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 58,
        "a": "0.00058",
        "r": "5800.55",
        "v": "580.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 59,
        "a": "0.00059",
        "r": "5900.55",
        "v": "590.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }, {
        "i": 60,
        "a": "0.00060",
        "r": "6000.55",
        "v": "600.01020300",
        "mo": "CyQQFbmz7GhBbsbI",
        "to": "aJZUXFxbvzAV1MIE",
        "t": 0
    }];
    const component = renderer.create(
        <LastTrades book={"btc_mxn"} trades={_60Trades}/>
    )
    let tree = component.toJSON();
    expect(tree).toMatchSnapshot();
});

test(componentName + 'Request to Bitso API', () => {
    var mock = new MockAdapter(axios);
    const _10Trades = {
        success: true,
        payload: [{
            "book": "btc_mxn",
            "created_at": "2018-06-03T18:59:01+0000",
            "amount": "0.01020640",
            "maker_side": "sell",
            "price": "154097.40",
            "tid": 7693079
        }, {
            "book": "btc_mxn",
            "created_at": "2018-06-03T18:59:02+0000",
            "amount": "0.02020640",
            "maker_side": "sell",
            "price": "154097.40",
            "tid": 7693079
        }, {
            "book": "btc_mxn",
            "created_at": "2018-06-03T18:59:03+0000",
            "amount": "0.03020640",
            "maker_side": "sell",
            "price": "154097.40",
            "tid": 7693079
        }, {
            "book": "btc_mxn",
            "created_at": "2018-06-03T18:59:04+0000",
            "amount": "0.04020640",
            "maker_side": "sell",
            "price": "154097.40",
            "tid": 7693079
        }, {
            "book": "btc_mxn",
            "created_at": "2018-06-03T18:59:05+0000",
            "amount": "0.05020640",
            "maker_side": "sell",
            "price": "154097.40",
            "tid": 7693079
        }, {
            "book": "btc_mxn",
            "created_at": "2018-06-03T18:59:06+0000",
            "amount": "0.06020640",
            "maker_side": "sell",
            "price": "154097.40",
            "tid": 7693079
        }, {
            "book": "btc_mxn",
            "created_at": "2018-06-03T18:59:07+0000",
            "amount": "0.07020640",
            "maker_side": "sell",
            "price": "154097.40",
            "tid": 7693079
        }, {
            "book": "btc_mxn",
            "created_at": "2018-06-03T18:59:08+0000",
            "amount": "0.08020640",
            "maker_side": "sell",
            "price": "154097.40",
            "tid": 7693079
        }, {
            "book": "btc_mxn",
            "created_at": "2018-06-03T18:59:09+0000",
            "amount": "0.09020640",
            "maker_side": "sell",
            "price": "154097.40",
            "tid": 7693079
        }, {
            "book": "btc_mxn",
            "created_at": "2018-06-03T18:59:10+0000",
            "amount": "0.01002060",
            "maker_side": "sell",
            "price": "154097.40",
            "tid": 7693079
        }]
    };
    mock.onGet('https://api.bitso.com/v3/trades/', {
        params: {book: "btc_mxn", sort: "desc", limit: 100}
    }).reply(200, _10Trades);
    const component = renderer.create(
        <LastTrades book={"btc_mxn"} trades={[]}/>
    )
    let tree = component.toJSON();
    expect(tree).toMatchSnapshot();
});